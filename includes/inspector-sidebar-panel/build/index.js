(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.primitives,a=window.ReactJSXRuntime,n=(0,a.jsx)(t.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,a.jsx)(t.Path,{d:"M18 11.3l-1-1.1-4 4V3h-1.5v11.3L7 10.2l-1 1.1 6.2 5.8 5.8-5.8zm.5 3.7v3.5h-13V15H4v5h16v-5h-1.5z"})}),o=window.wp.element,s=(0,o.forwardRef)((function({icon:e,size:t=24,...a},n){return(0,o.cloneElement)(e,{width:t,height:t,...a,ref:n})})),i=window.prcComponents,d=window.wp.i18n,l=window.React,r=window.wp.plugins,c=window.wp.editor,p=window.wp.data,h=window.wp.coreData,u=window.wp.components,w=window.wp.apiFetch;var m=e.n(w);function g({values:e=[30,60,90,60,100,50,45,20,70,80,90,40]}){const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=t=>{const a=t/Math.max(...e)*100;return 0===t?"none":a<=25?"low":a<=50?"medium":a<=75?"high":"very-high"};return(0,a.jsx)("div",{className:"calendar-chart",children:e.map(((e,o)=>(0,a.jsx)("div",{className:"calendar-chart-item","data-month":t[o],"data-heat":n(e),children:(0,a.jsx)("span",{className:"value",children:e})},o)))})}function _({postId:e}){const t=function(e){const[t,a]=(0,o.useState)(null);return(0,o.useEffect)((()=>{m()({path:`/prc-api/v3/datasets/download-stats?dataset_id=${e}`,method:"GET"}).then((e=>{a({success:!0,...e})})).catch((e=>{console.error({error:e})}))}),[e]),t}(e),n=(new Date).getFullYear(),s=(0,o.useMemo)((()=>t?.log?Object.keys(t.log):[]),[t]),[i,d]=(0,o.useState)(n),l=(0,o.useMemo)((()=>{if(!t?.log)return[];const e=t?.log[i]||{};for(let t=1;t<=12;t++){const a=t.toString().padStart(2,"0");a in e||(e[a]=0)}return Object.keys(e).sort(((e,t)=>e-t)).map((t=>e[t]))}),[t,i]),r=(0,o.useMemo)((()=>l.reduce(((e,t)=>e+t),0)),[l]);return(0,a.jsxs)(u.PanelBody,{title:"Dataset Download Stats",children:[(0,a.jsx)(u.SelectControl,{label:"Select Year",value:i,options:s.map((e=>({label:e,value:e}))),onChange:d}),(0,a.jsx)(u.BaseControl,{id:"dataset-download-stats",help:`Total: ${r}`,children:(0,a.jsx)(g,{values:l})})]})}const j="prc-platform-datasets-panel",v=["application/zip","application/pdf"];(0,r.registerPlugin)(j,{render:function(){const{postType:e,postId:t}=(0,p.useSelect)((e=>({postType:e(c.store).getCurrentPostType(),postId:e(c.store).getCurrentPostId()})),[]),[o,r]=(0,h.useEntityProp)("postType",e,"meta",t),{attachmentId:w,isAtp:m,datasetSchema:g}=(0,l.useMemo)((()=>({attachmentId:o._download_attachment_id||!1,isAtp:o.is_atp||!1,datasetSchema:o.dataset_schema||""})),[o]);return(0,a.jsxs)(l.Fragment,{children:[(0,a.jsx)(c.PluginSidebarMoreMenuItem,{target:j,icon:n,children:(0,d.__)("Dataset Options")}),(0,a.jsxs)(c.PluginSidebar,{name:j,title:"Dataset Options",icon:(0,a.jsx)(s,{icon:n,size:16}),children:[(0,a.jsxs)(u.PanelBody,{title:"Dataset File",children:[(0,a.jsx)(i.MediaDropZone,{attachmentId:w,disabled:!1,onUpdate:e=>{r({...o,_download_attachment_id:e.id})},editButtonLabel:(0,d.__)("Edit Dataset File"),onClear:!1,allowedTypes:v,label:(0,d.__)("Upload Dataset File (zip or pdf)"),singularLabel:(0,d.__)("dataset")}),(0,a.jsx)(u.CardDivider,{}),(0,a.jsx)(u.ToggleControl,{label:"ATP Dataset",help:"ATP datasets are bound by an opt-in to the ATP Terms of Service.",checked:m,onChange:e=>{r({...o,is_atp:e})}})]}),(0,a.jsx)(_,{postId:t})]}),(0,a.jsx)(c.PluginPrePublishPanel,{children:(0,a.jsxs)(u.PanelBody,{title:"Review Dataset Options",children:[(0,a.jsx)(i.MediaDropZone,{attachmentId:w,disabled:!1,onUpdate:e=>{r({...o,_download_attachment_id:e.id})},editButtonLabel:(0,d.__)("Edit Dataset File"),onClear:!1,allowedTypes:v,label:(0,d.__)("Upload Dataset File (zip or pdf)"),singularLabel:(0,d.__)("dataset")}),(0,a.jsx)(u.CardDivider,{}),(0,a.jsx)(u.ToggleControl,{label:"ATP Dataset",help:"ATP datasets are bound by an opt-in to the ATP Terms of Service.",checked:m,onChange:e=>{r({...o,is_atp:e})}})]})})]})}})})();
//# sourceMappingURL=index.js.map